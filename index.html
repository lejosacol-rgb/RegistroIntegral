<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>NoveClinic ‚Äì Sistema Base Definitivo</title>

<style>
body{font-family:Arial,Helvetica,sans-serif;margin:0;background:#f4f6f8}
header{background:#0b5ed7;color:#fff;padding:12px;text-align:center;font-size:18px}
nav{display:flex;flex-wrap:wrap;gap:8px;padding:10px;background:#e9ecef;justify-content:center}
nav button{padding:10px 16px;border:none;border-radius:10px;background:#0b5ed7;color:#fff;font-size:15px;cursor:pointer}
nav button.secondary{background:#6c757d}

/* ===== MODAL GENERAL ===== */
.modal-bg{
 position:fixed;top:0;left:0;width:100%;height:100%;
 background:rgba(0,0,0,.6);
 display:none;align-items:center;justify-content:center;
 z-index:1000;
}
.modal{
 background:#fff;border-radius:14px;
 width:92%;max-width:520px;
 padding:16px;max-height:90vh;
 overflow:auto;
 box-shadow:0 10px 35px rgba(0,0,0,.4);
 animation:zoom .2s ease;
 position:relative;
}
@keyframes zoom{from{transform:scale(.9);opacity:.6}to{transform:scale(1);opacity:1}}
.modal h3{text-align:center;margin-top:0}
.modal-close{
 position:absolute;top:12px;right:14px;
 background:#dc3545;color:#fff;border:none;
 border-radius:50%;width:34px;height:34px;
 cursor:pointer;font-weight:bold;
}

/* ===== FORM ===== */
.field{margin-bottom:10px}
.field label{font-weight:bold;display:block;margin-bottom:4px}
.field input,.field select{
 width:100%;padding:9px;border-radius:8px;border:1px solid #ccc;font-size:15px
}
.actions{display:flex;gap:8px;margin-top:12px}
.actions button{flex:1;padding:10px;border:none;border-radius:10px;font-size:15px;cursor:pointer}
.send{background:#25d366;color:#fff}
.clear{background:#dc3545;color:#fff}
.save{background:#0b5ed7;color:#fff}

/* ===== CONFIG ===== */
section{display:none;padding:12px}
section.active{display:block}
.card{background:#fff;border-radius:12px;padding:14px;box-shadow:0 2px 6px rgba(0,0,0,.15)}
.big-btn{
 display:block;margin:16px auto;padding:14px 22px;
 font-size:16px;border-radius:12px;
 background:linear-gradient(135deg,#0b5ed7,#0d6efd);
 color:#fff;border:none;cursor:pointer;
 box-shadow:0 4px 14px rgba(0,0,0,.25);
}
.big-btn:hover{opacity:.9}
.hidden{display:none}

/* ===== ICON PICKER ===== */
.icon-grid{
 display:grid;
 grid-template-columns:repeat(auto-fill,minmax(48px,1fr));
 gap:10px;
 text-align:center;
}
.icon-btn{
 font-size:24px;
 padding:8px;
 border-radius:10px;
 cursor:pointer;
 background:#f1f3f5;
 transition:.2s;
}
.icon-btn:hover{
 background:#0b5ed7;
 color:#fff;
 transform:scale(1.1);
}
</style>
</head>

<body>

<header>NoveClinic ‚Äì Registro Inteligente</header>
<nav id="mainNav"></nav>

<!-- CONFIG -->
<section id="config">
<div class="card">
<h3 style="text-align:center">‚öôÔ∏è Configuraci√≥n</h3>

<input id="newWinName" placeholder="Nombre de la ventana">
<button class="big-btn" onclick="createWindow()">‚ûï Crear ventana</button>

<hr>

<h4>‚ûï Crear etiqueta din√°mica</h4>

<div class="field">
<label>√çcono</label>
<div style="display:flex;gap:8px">
<input id="lbl_icon" placeholder="Selecciona un √≠cono" readonly>
<button onclick="openIconPicker()">üé®</button>
</div>
</div>

<input id="lbl_name" placeholder="Nombre etiqueta">

<select id="lbl_type">
<option value="text">Texto</option>
<option value="number">N√∫mero</option>
<option value="select">Desplegable</option>
<option value="auto">‚öôÔ∏è Autom√°tico</option>
</select>

<input id="lbl_values" placeholder="Valores (coma separados)">

<div id="auto_options" class="field hidden">
<label>Valor autom√°tico</label>
<select id="lbl_auto">
<option value="date">üìÖ Fecha</option>
<option value="time">‚è∞ Hora</option>
<option value="datetime">üìÖ‚è∞ Fecha y hora</option>
</select>
</div>

<div id="label_windows"></div>
<button class="big-btn" onclick="addLabel()">Guardar etiqueta</button>
</div>
</section>

<!-- MODAL FORM -->
<div id="modalBg" class="modal-bg">
<div class="modal">
<button class="modal-close" onclick="closeModal()">√ó</button>
<div id="modalContent"></div>
</div>
</div>

<!-- MODAL ICON PICKER -->
<div id="iconBg" class="modal-bg">
<div class="modal">
<button class="modal-close" onclick="closeIconPicker()">√ó</button>
<h3>üé® Selecciona un √≠cono</h3>
<div class="icon-grid" id="iconGrid"></div>
</div>
</div>

<script>
/* ===== STORAGE ===== */
function get(k){return JSON.parse(localStorage.getItem(k)||"{}")}
function set(k,v){localStorage.setItem(k,JSON.stringify(v))}

/* ===== STRUCTURE ===== */
let structure=get("structure");
if(!structure.windows){
 structure={windows:{base:{name:"Ventana Base"}},labels:{}};
 set("structure",structure);
}

/* ===== INIT ===== */
function init(){
 mainNav.innerHTML="";
 Object.entries(structure.windows).forEach(([id,w])=>{
  const b=document.createElement("button");
  b.textContent=w.name;
  b.onclick=()=>openModal(id);
  mainNav.appendChild(b);
 });
 const cfg=document.createElement("button");
 cfg.textContent="‚öôÔ∏è Configuraci√≥n";
 cfg.className="secondary";
 cfg.onclick=()=>openWin("config");
 mainNav.appendChild(cfg);
 renderLabelWindows();
}
init();

/* ===== MODAL FORM ===== */
function openModal(win){
 modalContent.innerHTML=`<h3>${structure.windows[win].name}</h3><div id="custom_${win}"></div>
 <div class="actions">
 <button class="send" onclick="previewWA('${win}')">üì§ WhatsApp</button>
 <button class="clear" onclick="clearForm('${win}')">üßπ Limpiar</button>
 </div>`;
 modalBg.style.display="flex";
 renderLabels();
}
function closeModal(){modalBg.style.display="none"}
function openWin(id){
 document.querySelectorAll("section").forEach(s=>s.classList.remove("active"));
 document.getElementById(id).classList.add("active");
}

/* ===== ICON PICKER ===== */
const icons=[
"üë§","üÜî","üìÖ","‚è∞","üìÖ‚è∞","üè•","üöë","‚ö†Ô∏è","üìù","üìç","üìû","üíä","ü©∫","ü©∏","üß†","‚ù§Ô∏è","üî¢","üìÑ","üìÇ","üßæ"
];

function openIconPicker(){
 iconGrid.innerHTML="";
 icons.forEach(i=>{
  const b=document.createElement("div");
  b.className="icon-btn";
  b.textContent=i;
  b.onclick=()=>{lbl_icon.value=i;closeIconPicker()};
  iconGrid.appendChild(b);
 });
 iconBg.style.display="flex";
}
function closeIconPicker(){iconBg.style.display="none"}

/* ===== LABELS ===== */
lbl_type.addEventListener("change",()=>{
 auto_options.classList.toggle("hidden",lbl_type.value!=="auto");
});

function autoValue(t){
 const d=new Date();
 if(t==="date")return d.toLocaleDateString("es-CO");
 if(t==="time")return d.toLocaleTimeString("es-CO");
 if(t==="datetime")return d.toLocaleString("es-CO");
 return "";
}

function addLabel(){
 const id="lbl_"+Date.now();
 const win={};
 document.querySelectorAll("#label_windows input").forEach(c=>win[c.value]=c.checked);
 structure.labels[id]={
  icon:lbl_icon.value||"",
  name:lbl_name.value,
  type:lbl_type.value,
  values:lbl_values.value.split(",").map(v=>v.trim()),
  auto:lbl_type.value==="auto"?lbl_auto.value:null,
  windows:win
 };
 set("structure",structure);
 lbl_icon.value="";lbl_name.value="";lbl_values.value="";
}

function renderLabels(){
 Object.keys(structure.windows).forEach(w=>{
  const c=document.getElementById("custom_"+w);
  if(!c)return;
  c.innerHTML="";
  Object.values(structure.labels).forEach(l=>{
   if(l.windows[w]){
    const d=document.createElement("div");
    d.className="field";
    d.innerHTML=`<label>${l.icon?l.icon+" ":""}${l.name}</label>`;
    let el;
    if(l.type==="select"){
     el=document.createElement("select");
     l.values.forEach(v=>el.add(new Option(v,v)));
    }else if(l.type==="auto"){
     el=document.createElement("input");
     el.value=autoValue(l.auto);el.readOnly=true;
    }else el=document.createElement("input");
    d.appendChild(el);c.appendChild(d);
   }
  });
 });
}

/* ===== UTILS ===== */
function previewWA(win){
 let t="";
 document.querySelectorAll(`#custom_${win} input,#custom_${win} select`).forEach(e=>{
  if(e.value)t+=e.previousSibling.textContent+": "+e.value+"\n";
 });
 window.open("https://wa.me/?text="+encodeURIComponent(t));
}
function clearForm(win){
 document.querySelectorAll(`#custom_${win} input`).forEach(i=>{
  if(!i.readOnly)i.value="";
 });
}
function createWindow(){
 const n=newWinName.value.trim();
 if(!n)return;
 structure.windows["win_"+Date.now()]={name:n};
 set("structure",structure);
 init();
 newWinName.value="";
}
function renderLabelWindows(){
 label_windows.innerHTML="";
 Object.keys(structure.windows).forEach(id=>{
  label_windows.innerHTML+=`<label><input type="checkbox" value="${id}" checked> ${structure.windows[id].name}</label><br>`;
 });
}
</script>

</body>
</html>
