<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Registro Integral de Salud</title>

<style>
:root{
  --bg:#f5f5f5;
  --card:#ffffff;
  --primary:#1976d2;
  --text:#222;
}
@media (prefers-color-scheme: dark){
  :root{
    --bg:#121212;
    --card:#1e1e1e;
    --text:#eee;
  }
}
body{
  margin:0;
  font-family:system-ui,sans-serif;
  background:var(--bg);
  color:var(--text);
}
#splash{
  position:fixed;inset:0;
  background:var(--primary);
  color:#fff;
  display:flex;
  flex-direction:column;
  align-items:center;
  justify-content:center;
  z-index:9999;
  animation:fadeOut .8s ease forwards;
  animation-delay:1.4s;
}
@keyframes fadeOut{to{opacity:0;visibility:hidden}}
header{
  padding:16px;
  background:var(--primary);
  color:#fff;
  display:flex;
  justify-content:space-between;
  align-items:center;
  font-size:20px;
}
header button{
  border:none;
  background:#ffffff22;
  color:#fff;
  border-radius:50%;
  width:42px;height:42px;
}
main{
  padding:16px;
  display:grid;
  grid-template-columns:repeat(auto-fit,minmax(140px,1fr));
  gap:12px;
}
.card{
  background:var(--card);
  border-radius:18px;
  padding:18px;
  text-align:center;
  font-size:18px;
  box-shadow:0 6px 14px rgba(0,0,0,.15);
  cursor:grab;
}
.modal{
  position:fixed;inset:0;
  background:rgba(0,0,0,.5);
  display:none;
  align-items:center;
  justify-content:center;
}
.modalContent{
  background:var(--card);
  width:92%;max-width:520px;
  border-radius:18px;
  padding:16px;
  max-height:90vh;
  overflow:auto;
}
.field{margin-bottom:10px}
label{font-weight:bold;display:block}
input,select{
  width:100%;
  padding:8px;
  border-radius:10px;
  border:1px solid #ccc;
}
.row{display:flex;gap:6px}
button{
  border:none;
  border-radius:12px;
  padding:10px 14px;
  background:var(--primary);
  color:#fff;
}
img.preview{
  width:100%;
  border-radius:12px;
  margin-top:6px;
}
</style>
</head>

<body>

<div id="splash">
  <h1>üè• Registro Integral</h1>
  <p>Sistema de Salud</p>
</div>

<header>
  üè• Registro Integral
  <button onclick="openConfig()">‚öôÔ∏è</button>
</header>

<main id="main"></main>

<div class="modal" id="config">
<div class="modalContent">
<h3>‚öôÔ∏è Configuraci√≥n</h3>
<label>üì§ WhatsApp</label>
<input id="wsap" placeholder="Ej: 573001234567">
<hr>
<input id="vName" placeholder="Nombre ventana">
<input id="vIcon" placeholder="Emoji">
<button onclick="addWindow()">Agregar ventana</button>
<hr>
<select id="fieldWin"></select>
<input id="cName" placeholder="Nombre campo">
<input id="cIcon" placeholder="Emoji">
<select id="cType">
  <option value="text">Texto</option>
  <option value="number">N√∫mero</option>
  <option value="auto">Autom√°tico</option>
</select>
<button onclick="addField()">Agregar campo</button>
<hr>
<button onclick="closeConfig()">Cerrar</button>
</div>
</div>

<div class="modal" id="formModal">
<div class="modalContent">
<h3 id="formTitle"></h3>
<div id="formFields"></div>
<div class="row">
<button onclick="sendWhats()">üì§</button>
<button onclick="closeForm()">Cerrar</button>
</div>
</div>
</div>

<script>
let data = JSON.parse(localStorage.getItem("appData")) || {windows:[],wsap:""};
let currentWin=null;

const save=()=>localStorage.setItem("appData",JSON.stringify(data));

function render(){
  main.innerHTML="";
  data.windows.forEach((w,i)=>{
    let d=document.createElement("div");
    d.className="card";
    d.innerHTML=`${w.icon}<br>${w.name}`;
    d.onclick=()=>openForm(i);
    main.appendChild(d);
  });
}

function openConfig(){
  wsap.value=data.wsap||"";
  fieldWin.innerHTML=data.windows.map((w,i)=>`<option value="${i}">${w.name}</option>`).join("");
  config.style.display="flex";
}
function closeConfig(){
  data.wsap=wsap.value;
  save();render();
  config.style.display="none";
}

function addWindow(){
  data.windows.push({name:vName.value,icon:vIcon.value,fields:[]});
  vName.value=vIcon.value="";
  save();openConfig();
}

function addField(){
  let w=data.windows[fieldWin.value];
  w.fields.push({name:cName.value,icon:cIcon.value,type:cType.value});
  cName.value=cIcon.value="";
  save();
}

function openForm(i){
  currentWin=i;
  let w=data.windows[i];
  formTitle.innerText=w.icon+" "+w.name;
  formFields.innerHTML="";
  w.fields.forEach((f,idx)=>{
    let d=document.createElement("div");
    d.className="field";
    d.innerHTML=`<label>${f.icon} ${f.name}</label>`;
    if(f.type==="auto"){
      d.innerHTML+=`<input data-i="${idx}" value="Autom√°tico" disabled>`;
    }else{
      d.innerHTML+=`<input data-i="${idx}">`;
    }
    formFields.appendChild(d);
  });
  formModal.style.display="flex";
}

function sendWhats(){
  let w=data.windows[currentWin];
  let now=new Date();
  let msg=`${w.icon} ${w.name}\n\n`;

  document.querySelectorAll("#formFields input").forEach(e=>{
    let f=w.fields[e.dataset.i];
    if(f.type==="auto"){
      let val=f.name.toLowerCase().includes("hora")
        ? now.toLocaleTimeString()
        : now.toLocaleDateString();
      msg+=`${f.icon} ${f.name}: ${val}\n`;
    }else{
      msg+=`${f.icon} ${f.name}: ${e.value}\n`;
    }
  });

  window.open(`https://wa.me/${data.wsap}?text=`+encodeURIComponent(msg));
}

function closeForm(){formModal.style.display="none"}

render();
</script>

</body>
</html>
